/*! lasertutor 13-05-2014 */
(function(){var a,b,c,d,e,f,g,h=function(a,b){return function(){return a.apply(b,arguments)}},i={}.hasOwnProperty,j=function(a,b){function c(){this.constructor=a}for(var d in b)i.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};e=null!=e?e:this,g=function(a,b){return e[a]=b,window[a]=b},f={},g("lasertutor",f),d=function(a,b,c,d,e){var f,g,h,i,j,k;return i=document.createElement("input"),i.setAttribute("type","text"),j=document.createElement("label"),j.setAttribute("for",b),j.textContent="",k={value:d,min:d,max:c,step:e,slide:a(j)},h=document.createElement("div"),f=document.createElement("p"),g=document.createElement("div"),$(g).slider(k),h.setAttribute("id",b),f.appendChild(j),h.appendChild(f),h.appendChild(g),h},f.createSlider=d,b=function(){function a(a){this.element=a,this.getMouseXY=h(this.getMouseXY,this),this.getTouchXY=h(this.getTouchXY,this),this.touchEnd=h(this.touchEnd,this),this.touchStart=h(this.touchStart,this),this.mouseUp=h(this.mouseUp,this),this.mouseDown=h(this.mouseDown,this),this.startPoint={x:50,y:50},this.interacting=!1,this.element.addEventListener("mousedown",this.mouseDown),window.addEventListener("mouseup",this.mouseUp),this.element.addEventListener("mousemove",this.mouseMove),this.element.addEventListener("wheel",this.mouseWheel),this.element.addEventListener("touchstart",this.touchStart),window.addEventListener("touchend",this.touchEnd),this.element.addEventListener("touchmove",this.touchMove)}return a.prototype.mouseDown=function(a){return this.interacting=!0,this.startPoint=this.getMouseXY(a)},a.prototype.mouseWheel=function(a){return console.log(a.deltaX+" "+a.deltaY+" "+a.deltaZ)},a.prototype.mouseUp=function(){return this.interacting=!1},a.prototype.touchStart=function(a){return this.interacting=!0,this.startPoint=this.getTouchXY(a)},a.prototype.touchEnd=function(){return this.interacting=!1},a.prototype.getTouchXY=function(a){var b;return b=this.element.getBoundingClientRect(),{x:a.targetTouches[0].clientX-b.left,y:a.targetTouches[0].clientY-b.top}},a.prototype.getMouseXY=function(a){var b;return b=this.element.getBoundingClientRect(),{x:a.clientX-b.left,y:a.clientY-b.top}},a}(),f.NavigationUI=b,a=function(a){function b(a){this.render=h(this.render,this),this.mouseWheel=h(this.mouseWheel,this),this.revolveCamera=h(this.revolveCamera,this),this.mouseMove=h(this.mouseMove,this),this.touchStart=h(this.touchStart,this),this.mouseDown=h(this.mouseDown,this);var c,d;this.ZOOMFACTOR=-.3,this.ROTATIONFACTOR=.006,b.__super__.constructor.call(this,a),this.scene=new THREE.Scene,c=new THREE.CylinderGeometry(.4,.4,.2,16),d=new THREE.MeshBasicMaterial({color:16776960}),this.focalPoint=new THREE.Mesh(c,d),this.scene.add(this.focalPoint),this.camera=new THREE.PerspectiveCamera(75,1,.1,1e3),this.camera.position.z=5,this.startCameraMatrix=this.camera.matrix.clone(),this.renderer=new THREE.WebGLRenderer,a.appendChild(this.renderer.domElement),this.renderer.setSize(500,500),this.interactionRegime=this.revolveCamera}return j(b,a),b.prototype.mouseDown=function(a){return b.__super__.mouseDown.call(this,a),this.startCameraMatrix=this.camera.matrix.clone(),this.interactionRegime=function(){switch(a.button){case 0:return function(a){return this.revolveCamera(this.getMouseXY(a))};case 4:return function(a){return this.translateFocalPoint(this.getMouseXY(a))}}}()},b.prototype.touchStart=function(a){return b.__super__.touchStart.call(this,a),this.startCameraMatrix=this.camera.matrix.clone(),this.interactionRegime=function(){switch(a.targetTouches.length){case 1:return function(a){return this.revolveCamera(this.getTouchXY(a))};case 2:return this.zoom;case 3:return function(a){return this.translateFocalPoint(this.getTouchXY(a))}}}.call(this)},b.prototype.mouseMove=function(a){return this.interacting?this.interactionRegime(a):void 0},b.prototype.revolveCamera=function(a){var b,c,d,e,f;return b=this.startPoint.x-a.x,c=this.startPoint.y-a.y,f=this.ROTATIONFACTOR*Math.sqrt(b*b+c*c),e=new THREE.Vector3(0,b,c),e.normalize(),d=new THREE.Matrix4,d.makeRotationAxis(e,f),d.multiply(this.startCameraMatrix),this.camera.position.setFromMatrixPosition(d),console.log(this.camera.position.toSource()),this.camera.rotation.setFromRotationMatrix(d)},b.prototype.mouseWheel=function(a){var b;return a.preventDefault(),b=new THREE.Vector3(0,0,this.ZOOMFACTOR*a.deltaY),this.camera.position=this.camera.localToWorld(b)},b.prototype.render=function(){return requestAnimationFrame(this.render),this.renderer.render(this.scene,this.camera)},b.prototype.addObject=function(a){return this.scene.add(a)},b}(b),f.NavigableScene=a,c=function(){function a(){}return a.prototype.normalizeMouseTravel=function(a,b,c,d){var e,f;return e=d.x-c.x,f=c.y-d.y,{x:e/a,y:f/b}},a.prototype.calculateRotationVector=function(a,b,c,d){var e;return null==c&&(c=2*Math.PI),null==d&&(d=1),b*=d,e=0===b?c:c/b,new THREE.Vector3(a.x*e,a.y*e,0)},a}(),f.ThreeDNavController=c}).call(this);